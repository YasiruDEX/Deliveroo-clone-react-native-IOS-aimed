import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{studioPath as r,applySourceDocuments as i,getPublishedId as o}from"@sanity/client/csm";import{Card as a,Flex as s,Container as c,Stack as d,Text as l,Inline as u,Box as p,Button as h,Code as f,Label as m,ErrorBoundary as v,TextInput as g,Switch as w,usePrefersReducedMotion as y,TooltipDelayGroupProvider as b,Tooltip as k,MenuButton as x,Menu as P,MenuItem as S,Spinner as I,useToast as C,BoundaryElementProvider as E}from"@sanity/ui";import{useContext as z,forwardRef as D,useCallback as L,useMemo as U,useState as $,useEffect as R,useSyncExternalStore as j,memo as O,createContext as T,useLayoutEffect as M,useRef as W,createElement as _,startTransition as A}from"react";import{useUnique as N,getPublishedId as F,useClient as K,useActiveWorkspace as B,Hotkeys as V,useCurrentUser as q,useProjectId as J,useDataset as G}from"sanity";import{StateLink as X,useRouter as H}from"sanity/router";import Z from"styled-components";import{P as Q,L as Y,a as ee,b as te,c as ne,M as re,A as ie,d as oe,D as ae}from"./index-scF3Q7eu.js";import{PaneRouterContext as se,PaneLayout as ce,DeskToolProvider as de,DocumentListPane as le,useDeskTool as ue,DocumentPane as pe}from"sanity/desk";import{D as he}from"./DisplayedDocumentBroadcaster-VVQiO-FG.js";import{applyPatch as fe}from"mendoza";import me from"mnemonist/lru-cache-with-delete";import{ResetIcon as ve,PanelLeftIcon as ge,RefreshIcon as we,ShareIcon as ye,ChevronDownIcon as be,CheckmarkIcon as ke,DesktopIcon as xe,MobileDeviceIcon as Pe,LaunchIcon as Se,CopyIcon as Ie,EditIcon as Ce,PublishIcon as Ee,DatabaseIcon as ze}from"@sanity/icons";import{createPreviewSecret as De}from"@sanity/preview-url-secret/create-secret";import{withoutSecretSearchParams as Le,hasSecretSearchParams as Ue,setSecretSearchParams as $e}from"@sanity/preview-url-secret/without-secret-search-params";import{motion as Re,MotionConfig as je,AnimatePresence as Oe}from"framer-motion";import Te from"fast-deep-equal";import{definePreviewUrl as Me}from"@sanity/preview-url-secret/define-preview-url";import{suspend as We}from"suspend-react";let _e;const Ae=new Uint8Array(16);function Ne(){if(!_e&&(_e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_e))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _e(Ae)}const Fe=[];for(let e=0;e<256;++e)Fe.push((e+256).toString(16).slice(1));var Ke={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Be(e,t,n){if(Ke.randomUUID&&!t&&!e)return Ke.randomUUID();const r=(e=e||{}).random||(e.rng||Ne)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Fe[e[t+0]]+Fe[e[t+1]]+Fe[e[t+2]]+Fe[e[t+3]]+"-"+Fe[e[t+4]]+Fe[e[t+5]]+"-"+Fe[e[t+6]]+Fe[e[t+7]]+"-"+Fe[e[t+8]]+Fe[e[t+9]]+"-"+Fe[e[t+10]]+Fe[e[t+11]]+Fe[e[t+12]]+Fe[e[t+13]]+Fe[e[t+14]]+Fe[e[t+15]]}(r)}const Ve=1e3,qe=1e3,Je=500,Ge=["handshake/syn","handshake/syn-ack","handshake/ack"],Xe=e=>Ge.some((t=>t===e)),He=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function Ze(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(Xe(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),d(e,"handshake/ack",{id:e.id}))}}const o=t=>{const{data:r}=t;if(!Xe(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),l(t,"channel/response",{responseTo:r.id},!1)}}};function a(t){if(He(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function s(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,s(t),function(e){e.id=Be(),e.interval=window.setInterval((()=>{d(e,"handshake/syn",{id:e.id})}),Je)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(s(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:qe;e.heartbeat=window.setInterval((()=>{l(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{l(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),s(t))}function d(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:Be(),to:n.config.id,type:r};try{t?.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error(`Failed to postMessage '${o.id}' on '${e.id}'`)}}function l(n,r,i,o=!0){const a=Be();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{s.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${s.type}' on client '${e.id}' (ID: '${s.id}').`))}),Ve),o=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===s.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{t?.postMessage(s,{targetOrigin:e.targetOrigin})}catch(t){throw new Error(`Failed to postMessage '${s.id}' on client '${e.id}'`)}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(l(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{s(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");l(i,t,r)}))}}}const Qe=/^([A-Za-z]+):([0-9]+)$/,Ye=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,et=/^([A-Za-z]+):([a-z0-9]+)$/;const tt={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function nt(e,t){return e.every((e=>tt[e]?t[tt[e]]:t.key===e.toUpperCase()))}function rt(e){return"Alt"===e.key}function it(e){if(void 0===e)return;const t=decodeURIComponent(e)?.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function ot(e){if(void 0!==e)return r.toString(function(e){const t=[];for(const n of e.split(".")){const e=Qe.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=Ye.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=et.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function at(n){const{children:r,message:i,onRetry:o,onContinueAnyway:f,...m}=n,v=e(h,{fontSize:1,mode:"ghost",onClick:o,text:"Retry"}),g=e(h,{fontSize:1,mode:"ghost",tone:"critical",onClick:f,text:"Continue anyway"});return e(a,{height:"fill",...m,children:e(s,{align:"center",height:"fill",justify:"center",children:e(c,{padding:4,sizing:"border",width:0,children:t(d,{space:4,children:[t(d,{space:3,children:[e(l,{size:1,weight:"semibold",children:"An error occured"}),e(l,{muted:!0,size:1,children:i})]}),r,o&&f?t(u,{space:2,children:[v,g]}):o?e(p,{children:v}):f?e(p,{children:g}):null]})})})})}function st(){const e=z(Q);if(!e)throw new Error("Presentation context is missing");return e}function ct(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const dt=D((function(t,n){const{deskParams:r,params:i}=st();return e(X,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),lt=D((function(t,n){const{documentId:r,documentType:i,...o}=t;return e(X,{...o,ref:n,state:{id:r,type:i},title:void 0})}));function ut(t){const{children:r,params:i,onDeskParams:o,previewUrl:a,refs:s}=t,{state:c,resolvePathFromState:d}=H(),l=N(Object.fromEntries(c._searchParams||[])),u=L((e=>`${d(c)}${ct({...l,...e})}`),[d,l,c]),p=U((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,i=s?.find((e=>F(e._id)===n));return i?e(X,{...r,state:{id:i._id,type:i._type,_searchParams:Object.entries({preview:a})}}):e("div",{...r})},BackLink:dt,ReferenceChildLink:lt,ParameterizedLink:()=>e(n,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{o({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:u})),[u,o,i,a,s]);return e(se.Provider,{value:p,children:r})}const pt=Z(ce)`
  height: 100%;
`,ht=Z(s)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,ft=Z(f)`
  white-space: pre-wrap;
`;function mt(n){const{onDeskParams:r,previewUrl:i,refs:o}=n,{devMode:s}=st(),c=U((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:o.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[o]),[l,u]=$(null),p=L((()=>u(null)),[]),[h]=$((()=>({})));return R((()=>u(null)),[o]),l?e(at,{flex:1,message:"Could not render the document list",onRetry:p,children:s&&e(a,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(d,{space:3,children:[e(m,{muted:!0,size:0,children:"Error message"}),e(ft,{size:1,children:l.error.message})]})})}):e(v,{onCatch:u,children:e(pt,{children:e(de,{children:e(ut,{params:h,onDeskParams:r,previewUrl:i,refs:o,children:e(ht,{direction:"column",flex:1,children:e(le,{index:0,itemId:"$root",pane:c,paneKey:"$root"})})})})})})}function vt(t){const{onDeskParams:n,previewUrl:r,refs:i}=t,o=U((()=>i.map((({_id:e,_type:t})=>({_id:it(e),_type:t})))),[i]);return e(mt,{onDeskParams:n,previewUrl:r,refs:o})}const gt=Z(f)`
  white-space: pre-wrap;
`;function wt(n){const{documentId:r,documentType:i,params:o,onDeskParams:s,onFocusPath:c}=n,{devMode:l}=st(),u=U((()=>({id:r,options:{id:r,type:i},title:"",type:"document"})),[r,i]),[p,h]=$(null),f=L((()=>h(null)),[]);R((()=>{h(null)}),[r,i,o]);const{setLayoutCollapsed:g}=ue(),w=L((()=>g(!0)),[g]),y=L((()=>g(!1)),[g]);return p?e(at,{flex:1,message:"Could not render the document editor",onRetry:f,children:l&&e(a,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(d,{space:3,children:[e(m,{muted:!0,size:0,children:"Error message"}),e(gt,{size:1,children:p.error.message})]})})}):e(v,{onCatch:h,children:e(ce,{style:{height:"100%"},onExpand:y,onCollapse:w,children:e(ut,{onDeskParams:s,params:o,children:e(pe,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:c})})})})}function yt(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}=t;return e(de,{children:e(wt,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:a})})}function bt(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,previewUrl:s,refs:c}=t;return r&&i?e(yt,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}):e(vt,{onDeskParams:o,previewUrl:s,refs:c})}function kt(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}function xt(r){const{liveDocument:i,channel:o,perspective:a,liveQueries:s,documentsOnPage:c}=r,[d]=$((()=>new me(Y))),l=K({apiVersion:"2023-10-16"}),u=U((()=>l.config()),[l]),p=U((()=>l.withConfig({resultSourceMap:"withKeyArraySelector"})),[l]);R((()=>{if(o){const{projectId:e,dataset:t}=u;o.send("loaders","loader/perspective",{projectId:e,dataset:t,perspective:a})}}),[o,u,a]);const h=U((()=>{const e=c.map((({_id:e})=>e)),t=[...new Set(e)],n=d.capacity;return t.length>=n&&(t.length=n),t}),[d.capacity,c]),[f,m]=$(0);return t(n,{children:[e(Pt,{cache:d,client:p,turboIds:h,setDocumentsCacheLastUpdated:m}),Object.entries(s).map((([t,{query:n,params:r,perspective:s}])=>e(It,{cache:d,projectId:u.projectId,dataset:u.dataset,perspective:s,query:n,params:r,channel:o,client:p,refreshInterval:a?2e3:0,liveDocument:i,documentsCacheLastUpdated:f},`${t}${s}`)))]})}const Pt=O((function(t){const{cache:r,client:i,turboIds:o,setDocumentsCacheLastUpdated:a}=t,[s,c]=$([]);return R((()=>{const e=new Set(s.flat()),t=new Set;for(const n of o)e.has(n)||r.has(n)||t.add(n);const n=[...t].slice(0,ee);0!==n.length&&c((e=>[...e.slice(-ee),n]))}),[s,r,o]),R((()=>{const e=i.listen("*",{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"===e.type&&"disappear"===e.transition&&r.delete(e.documentId)&&a(Date.now()),"mutation"!==e.type||!e.effects?.apply?.length)return;const t=r.peek(e.documentId);if(t){const n={...t};delete n._rev;const i=fe(n,e.effects.apply);r.set(e.documentId,i),a(Date.now())}}));return()=>e.unsubscribe()}),[r,i,a]),e(n,{children:s.map((t=>e(St,{cache:r,client:i,ids:t,setDocumentsCacheLastUpdated:a},JSON.stringify(t))))})})),St=O((function(e){const{client:t,cache:n,ids:r,setDocumentsCacheLastUpdated:i}=e;return R((()=>{const e=r.filter((e=>!n.has(e)));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&(n.set(t._id,t),i(Date.now()))}),console.error)}),[n,t,r,i]),null}));function It(e){const{cache:t,projectId:n,dataset:r,perspective:i,query:o,client:a,refreshInterval:s,liveDocument:c,channel:d,documentsCacheLastUpdated:l}=e,u=function(e){const t=U((()=>JSON.stringify(e||{})),[e]);return U((()=>JSON.parse(t)),[t])}(e.params),p=function(e){const{cache:t,liveDocument:n,client:r,refreshInterval:i,query:o,params:a,perspective:s,documentsCacheLastUpdated:c}=e,[d,l]=$(null),{projectId:u,dataset:p}=U((()=>{const{projectId:e,dataset:t}=r.config();return{projectId:e,dataset:t}}),[r]),[h,f]=$(null);if(h)throw h;const[m,v]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=$(!1);R((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=j(kt,(()=>document.visibilityState),(()=>"hidden"));return!e||"hidden"===n}(),[r,i]=$("hit"),o=L((()=>(i("inflight"),()=>i("hit"))),[]);return R((()=>{if(!t||"hit"!==r)return;const e=setTimeout((()=>i("stale")),t);return()=>clearTimeout(e)}),[t,r]),R((()=>{if("hit"!==r)return;const e=()=>i("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,r]),R((()=>{n&&"hit"===r&&i("stale"),n||"stale"!==r||i("refresh")}),[n,r]),[r,o]}({refreshInterval:i}),g="refresh"===m||"inflight"===m;return R((()=>{if(!g)return;let e=!1,t=!1;const n=new AbortController;async function i(){const{signal:i}=n;t=!0;const{result:c,resultSourceMap:d}=await r.fetch(o,a,{tag:"presentation-loader",signal:i,perspective:s,filterResponse:!1});t=!1,i.aborted||(l({result:c,resultSourceMap:d}),e=!0)}const c=v();return i().catch((e=>{t=!1,"AbortError"!==e.name&&f(e)})).finally(c),()=>{e||t||n.abort()}}),[r,p,n,a,s,u,o,g,v]),U((()=>c&&d?.resultSourceMap?{result:Et(t,n,d.result,s,d.resultSourceMap),resultSourceMap:d.resultSourceMap}:d),[t,c,n,s,d])}({cache:t,client:a,liveDocument:c,params:u,perspective:i,query:o,refreshInterval:s,documentsCacheLastUpdated:l}),h=p?.result,f=p?.resultSourceMap;return R((()=>{f&&d.send("loaders","loader/query-change",{projectId:n,dataset:r,perspective:i,query:o,params:u,result:h,resultSourceMap:f})}),[d,r,u,i,n,o,h,f]),null}St.displayName="GetDocuments";let Ct=!1;function Et(e,t,n,r,a){if("raw"===r)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return i(n,a,(n=>{if(!n._projectId)return t?._id&&o(t._id)===o(n._id)?t:e.get(n._id);Ct||(console.warn("Cross dataset references are not supported yet, ignoring source document",n),Ct=!0)}),((e,{previousValue:t})=>"number"==typeof e&&"string"==typeof t?`${e}`:e),r)}const zt=T(null);zt.displayName="PanelsContext";const Dt=Z.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,Lt=function({children:t,defaultSize:n=null,id:r,minWidth:i,maxWidth:o,order:a=0}){const s=z(zt);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:c,registerElement:d,unregisterElement:l}=s,u=c(r);return M((()=>(d(r,{id:r,type:"panel",defaultSize:n,maxWidth:o??null,minWidth:i??0,order:a}),()=>{l(r)})),[r,n,a,o,i,d,l]),e(Dt,{style:u,children:t})};const Ut=Z.div`
  position: relative;
`,$t=Z.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,Rt=function({id:n,order:r,disabled:i=!1}){const o=W(null),a=z(zt);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return W(e||Be()).current}(n),{activeResizer:c,drag:d,startDragging:l,stopDragging:u,registerElement:p,unregisterElement:h}=a,f=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=L((e=>{l(s,e.nativeEvent)}),[s,l]),v=L((e=>{d(s,e)}),[s,d]),g=L((()=>{o.current.blur(),u()}),[u]);return R((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),M((()=>(p(s,{id:s,order:r,type:"resizer",el:o}),()=>{h(s)})),[s,r,p,h]),e(Ut,{onMouseDown:m,ref:o,children:t($t,{$disabled:i,children:[e("span",{}),e("span",{})]})})};function jt(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Ot="presentation/panels",Tt=()=>JSON.parse(localStorage.getItem(Ot)||"{}"),Mt=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Wt(){return U((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Ot,JSON.stringify(e))})({...Tt(),[Mt(e)]:t})};return{get:e=>Tt()[Mt(e)],set:e,setDebounced:jt(e,100)}}),[])}function _t(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function At(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Nt(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Ft(e){return"panel"===e.type}function Kt(e){return"resizer"===e.type}function Bt(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function Vt(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=_t(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}const qt=Z.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Jt=function({children:t}){const n=W(null),[r,i]=$(new Map),o=U((()=>Bt(r).filter(Ft)),[r]),[a,s]=$([]),[c,d]=$(null),l=W({elements:r,panels:o,widths:a}),u=L((e=>({flexGrow:At(o,e,a),pointerEvents:null===c?void 0:"none"})),[c,o,a]),p=L(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=L((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),f=W({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),m=L(((e,t)=>{const n=Bt(r),i=n.findIndex((t=>t.id===e)),o=r.get(e);if(!o||!Kt(o))return;const a=o.el.current;a&&(f.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>Ft(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Ft(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Nt(t,a),resizerRect:a.getBoundingClientRect(),widths:l.current.widths},d(e))}),[r]),v=L((()=>{d(null)}),[]),g=L(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:a,panelAfter:c,resizerRect:d}=f.current;if(null==a||null==c)return;const u=r.get(e);if(!u||!Kt(u))return;const p=u.el.current;if(!p)return;const h=Nt(t,p,o,d);if(0===h)return;const{widths:m}=l.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,d=c||s,l=[...d];{const i=e<0?r:n,o=d[a.findIndex((e=>e.id===i.id))],s=_t(i,o+Math.abs(e),t);if(o===s)return d;e=e<0?o-s:s-o}let u=0,p=e<0?n:r,h=a.findIndex((e=>e.id===p.id));for(;;){const n=a[h],r=d[h],i=_t(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,l[h]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return 0===u?d:(p=e<0?r:n,h=a.findIndex((e=>e.id===p.id)),l[h]=d[h]+u,l)}(h/n.current.getBoundingClientRect().width*100,i,a,c,l.current,f.current),g=m.some(((e,t)=>e!==v[t]));g&&s(v)}),[r]);M((()=>{l.current.elements=r,l.current.panels=o,l.current.widths=a}),[r,o,a]);const w=Wt();M((()=>{const{widths:e}=l.current;if(e.length===o.length)return;const t=w.get(o);if(t){const e=Vt(o,t,window.innerWidth);return void s(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);s(n)}),[w,o]),R((()=>{a.length&&w.setDebounced(o,a)}),[w,o,a]),M((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=l.current,n=Vt(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&s(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const y=U((()=>({activeResizer:c,drag:g,getPanelStyle:u,registerElement:p,startDragging:m,stopDragging:v,unregisterElement:h})),[c,g,u,p,m,v,h]);return e(zt.Provider,{value:y,children:e(qt,{ref:n,children:t})})},Gt=function(t){const{children:n,navigate:r}=t,i=L((e=>{r({},{preview:e})}),[r]),o=U((()=>i),[i]);return e(te.Provider,{value:o,children:n})};function Xt(t){const{unstable_navigator:r}=t,i=!!r?.component,[o,a]=function(e,t){const[n,r]=$((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return R((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",i),s=!!i&&o,c=U((()=>{if(i)return()=>a((e=>!e))}),[i,a]),d=L((function(){return e(n,{children:s&&e(Ht,{...r})})}),[s,r]);return[{navigatorEnabled:s,toggleNavigator:c},d]}const Ht=O((function(r){const{minWidth:i,maxWidth:o,component:a}=r,s=null!=i&&null!=o&&i===o;return t(n,{children:[e(Lt,{id:"navigator",minWidth:i,maxWidth:o,order:1,children:e(a,{})}),e(Rt,{order:2,disabled:s})]})})),Zt=function(t){const{children:n,params:r}=t,i=U((()=>r),[r]);return e(ne.Provider,{value:i,children:n})},Qt=function(t){const{children:n,deskParams:r,devMode:i,name:o,navigate:a,params:s}=t,c=U((()=>({deskParams:r,devMode:i,name:o,navigate:a,params:s})),[r,i,o,a,s]);return e(Q.Provider,{value:c,children:n})},Yt=Re(Z.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),en=function(t){const{basePath:r="/"}=B()?.activeWorkspace||{},{fontSize:i=1,onChange:o,origin:a,padding:s=3,value:c}=t,d=W(null),[l,u]=$(void 0),[p,h]=$(void 0),f=L((e=>{u(e.currentTarget.value)}),[]),m=L((e=>{if("Enter"===e.key){if(void 0===l)return;const e=l.startsWith("/")||""===l?`${a}${l}`:l;if(!e.startsWith(a+"/")&&e!==a)return void h(`URL must start with ${a}`);if(!a&&(e.startsWith(`${r}/`)||e===r))return void h(`URL can't have the same base path as the Studio ${r}`);const t=e===a?a+"/":e;h(void 0),u(void 0),o(t.slice(a.length)),d.current?.blur()}"Escape"===e.key&&(h(void 0),u(void 0))}),[r,o,a,l]),v=L((()=>{h(void 0),u(void 0)}),[]);R((()=>{h(void 0),u(void 0)}),[a,c]);const w=U((()=>({icon:ve})),[]);return e(n,{children:e(g,{clearButton:p?w:void 0,customValidity:p,fontSize:i,onBlur:v,onClear:()=>{h(void 0),u(a+c)},onChange:f,onKeyDownCapture:m,padding:s,style:{zIndex:1},radius:2,ref:d,space:s,value:void 0===l?`${a}${c}`:l})})},tn=Re(s),nn=Z(w)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,rn={previewDrafts:"Drafts",published:"Published",raw:"Raw"},on="caution",an="positive",sn={previewDrafts:Ce,published:Ee,raw:ze},cn=D((function(r,i){const{initialUrl:o,targetOrigin:c,navigatorEnabled:u,onPathChange:v,openPopup:g,overlayEnabled:w,params:C,perspective:E,setPerspective:z,toggleNavigator:D,toggleOverlay:j,loadersConnection:O,overlaysConnection:T,previewKitConnection:M}=r,{devMode:W}=st(),[A,N]=$("desktop"),F=y(),K=L((()=>N("desktop")),[N]),B=L((()=>N("mobile")),[N]),[q,J]=$(!0),[G,X]=$(!1),[H,Z]=$(!1),[Q,Y]=$(!1),ee=q||H||"connecting"===T,te=U((()=>c===location.origin?"":c),[c]),ne=L((()=>{"function"!=typeof i&&i?.current&&(i.current.src=`${c}${C.preview||"/"}`,Z(!0))}),[C.preview,c,i]),ie=L((()=>{"function"!=typeof i&&i?.current&&(i.current.src=o.toString(),Z(!0))}),[i,o]),oe=L((()=>{se(!0)}),[]),[ae,se]=$(!1),[ce,de]=$(!1);R((()=>{if(!(q||H||"connecting"!==T&&"reconnecting"!==T)){const e=setTimeout((()=>{de(!0)}),1e3);return()=>clearTimeout(e)}}),[T,q,H,de]),R((()=>{if(!q&&!H&&ce){if("connected"===T&&(Y(!1),de(!1),X(!1),se(!1)),"connecting"===T){const e=setTimeout((()=>{X(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),re);return()=>clearTimeout(e)}if("reconnecting"===T){const e=setTimeout((()=>{X(!0),Y(!0)}),re);return()=>clearTimeout(e)}"disconnected"===T&&Y(!0)}}),[q,T,H,ce]);const le=U((()=>{const e=new URL(C.preview||"/",c),{pathname:t,search:n}=Le(e);return`${t}${n}`}),[C.preview,c]),ue=L((()=>{J(!1),Z(!1)}),[]);return e(je,{transition:F?{duration:0}:void 0,children:t(b,{delay:1e3,children:[e(a,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:t(s,{align:"center",gap:2,style:{minHeight:0},children:[D&&e(k,{animate:!0,content:e(l,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(h,{"aria-label":"Toggle navigator",fontSize:1,icon:ge,mode:"bleed",onClick:D,padding:3,selected:u})}),e(k,{animate:!0,content:t(s,{align:"center",style:{whiteSpace:"nowrap"},children:[e(p,{padding:1,children:e(l,{size:1,children:w?"Disable edit overlay":"Enable edit overlay"})}),e(p,{paddingY:1,children:e(V,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e(a,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:w?"positive":void 0,children:t(s,{align:"center",gap:2,children:[e("div",{style:{margin:-2},children:e(nn,{checked:w,onChange:j,disabled:ee})}),e(p,{children:e(l,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),W&&e(k,{animate:!0,content:e(l,{size:1,children:H?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(h,{"aria-label":"Refresh preview",fontSize:1,icon:we,mode:"bleed",loading:H,onClick:ne,padding:3})}),e(p,{flex:1,children:e(en,{onChange:v,origin:te,value:le})}),e(s,{align:"center",flex:"none",gap:1,children:e(x,{button:e(h,{fontSize:1,iconRight:ye,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e(P,{children:e(hn,{initialUrl:o,openPopup:g,previewLocationOrigin:te,previewLocationRoute:le})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e(s,{align:"center",flex:"none",gap:1,children:e(x,{button:e(h,{fontSize:1,iconRight:be,mode:"bleed",padding:3,space:2,text:rn[E],loading:ee||"connecting"===O&&"connected"!==M,disabled:"connected"!==O}),id:"perspective-menu",menu:t(P,{style:{maxWidth:240},children:[e(S,{fontSize:1,onClick:()=>z("previewDrafts"),padding:3,pressed:"previewDrafts"===E,tone:on,children:t(s,{align:"flex-start",gap:3,children:[e(p,{flex:"none",children:e(l,{size:1,children:_(sn.previewDrafts)})}),t(d,{flex:1,space:2,children:[e(l,{size:1,weight:"medium",children:rn.previewDrafts}),e(l,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e(p,{flex:"none",children:e(l,{muted:!0,size:1,style:{opacity:"previewDrafts"===E?1:0},children:e(ke,{})})})]})}),e(S,{fontSize:1,onClick:()=>z("published"),padding:3,pressed:"published"===E,tone:an,children:t(s,{align:"flex-start",gap:3,children:[e(p,{flex:"none",children:e(l,{size:1,children:_(sn.published)})}),t(d,{flex:1,space:2,children:[e(l,{size:1,weight:"medium",children:rn.published}),e(l,{muted:!0,size:1,children:"View this page with published content"})]}),e(p,{flex:"none",children:e(l,{muted:!0,size:1,style:{opacity:"published"===E?1:0},children:e(ke,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),t(s,{align:"center",flex:"none",gap:1,children:[e(k,{animate:!0,content:e(l,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(h,{"aria-label":"Full viewport",fontSize:1,icon:xe,mode:"bleed",onClick:K,padding:3,selected:"desktop"===A})}),e(k,{animate:!0,content:e(l,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e(h,{"aria-label":"Narrow viewport",fontSize:1,icon:Pe,mode:"bleed",onClick:B,padding:3,selected:"mobile"===A})})]})]})}),e(a,{flex:1,tone:"transparent",children:t(s,{align:"center",height:"fill",justify:"center",padding:"desktop"===A?0:2,sizing:"border",style:{position:"relative",cursor:ee?"wait":void 0},children:[e(Oe,{children:Q||q||H||!ce||ae?!q&&!ee||ae?Q&&!ae?e(tn,{initial:"initial",animate:"animate",exit:"exit",variants:un,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e(at,{flex:1,message:"Could not connect to the preview",onRetry:ie,onContinueAnyway:oe,children:W&&t(n,{children:["connected"!==T&&e(a,{padding:3,radius:2,tone:"critical",children:t(d,{space:3,children:[e(m,{muted:!0,size:0,children:"Overlay connection status"}),e(f,{size:1,children:T})]})}),"connected"!==O&&e(a,{padding:3,radius:2,tone:"critical",children:t(d,{space:3,children:[e(m,{muted:!0,size:0,children:"Loader connection status"}),e(f,{size:1,children:O})]})})]})})}):null:e(tn,{initial:"initial",animate:"animate",exit:"exit",variants:ln,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:t(s,{style:{...dn[A]},justify:"center",align:"center",direction:"column",gap:4,children:[e(I,{muted:!0}),e(l,{muted:!0,size:1,children:"Loading…"})]})}):e(tn,{initial:"initial",animate:"animate",exit:"exit",variants:ln,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:G?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:G?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:t(s,{style:{...dn[A]},justify:"center",align:"center",direction:"column",gap:4,children:[G&&e(h,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e(a,{radius:2,tone:G?"caution":"inherit",padding:4,shadow:1,children:t(s,{justify:"center",align:"center",direction:"column",gap:4,children:[e(I,{muted:!0}),e(l,{muted:!0,size:1,children:G?e(n,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),G&&e(h,{fontSize:1,tone:"critical",onClick:oe,text:"Continue anyway"})]})})}),e(Yt,{ref:i,style:{pointerEvents:ee&&!ae?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:o.toString(),initial:["background"],variants:pn,animate:[!q&&!ee||ae?"active":"background",H?"reloading":"idle",A,ce&&!ae?"timedOut":""],onLoad:ue})]})})]})})})),dn={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},ln={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},un={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},pn={desktop:{...dn.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...dn.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function hn(r){const{initialUrl:i,openPopup:o,previewLocationOrigin:a,previewLocationRoute:s}=r,c=L((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return t(n,{children:[e(fn,{initialUrl:i,previewLocationOrigin:a,previewLocationRoute:s}),e(S,{icon:Se,text:"Open preview",as:"a",href:`${a}${s}`,onClick:c,rel:"opener",target:"_blank"})]})}function fn(t){const{initialUrl:n,previewLocationOrigin:r,previewLocationRoute:i}=t,{push:o}=C(),a=K({apiVersion:ie}),s=q(),[c,d]=$(!1);return e(S,{disabled:c,onClick:()=>{if(!navigator?.clipboard)return o({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;d(!0);let t=`${r}${i}`;const c=()=>{o({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),d(!1)},l=e=>{o({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),d(!1)};if(Ue(n)&&"undefined"!=typeof ClipboardItem){const r="text/plain",d=new ClipboardItem({[r]:(async()=>{e=o({closable:!0,title:"Copying URL to clipboard…"});const c=await De(a,"@sanity/presentation","undefined"==typeof window?"":location.href,s?.id),d=$e(n,c.secret,i);return t=d.toString(),new Blob([t],{type:r})})()});navigator.clipboard.write([d]).then(c).catch(l)}else navigator.clipboard.writeText(t).then(c).catch(l)},text:"Copy link",icon:Ie})}let mn=!1;function vn(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function gn({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r,previewRef:i}){const o=U((()=>{const{id:t,path:i,type:o}={id:it((a=n).id),path:ot(a.path),type:a.type};var a;return{id:t,type:o,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}}),[n,r,e]),a=U((()=>vn({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]),s=W(n);R((()=>{s.current=n}),[n]);return{deskParams:a,navigate:U((()=>jt(((e,n={},r)=>{const{_searchParams:o,...a}=s.current,c=(o||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),d=vn({...a,...e}),l=vn({...c,...n});d._searchParams=Object.entries(l).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const u=r??l.preview===i.current;t(d,{replace:u})}),50)),[t,i]),params:o}}function wn(e,t,n){const r=K({apiVersion:ie}),i=B(),o=i?.activeWorkspace?.basePath||"/",a=function(e,t,n){const r=q();return U((()=>["@sanity/presentation",t,n,e,r?.id,yn]),[t,r?.id,e,n])}(t,o,i?.activeWorkspace?.name||"default"),s=function(e,t){const n=K({apiVersion:ie}),r=q(),[i,o]=$(""),a=e?We((async()=>await De(n,"@sanity/presentation","undefined"==typeof window?"":location.href,r?.id)),[...t,i]):null;return R((()=>{if(!a)return;const e=setTimeout((()=>{A((()=>o(a.expiresAt.toString())))}),a.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[a]),a?.secret||null}("object"==typeof e||"function"==typeof e,a);return We((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${o}/`)&&r.pathname!==o?r:t}const t="object"==typeof e?Me(e):e,i=await t({client:r,previewUrlSecret:s,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:o});return new URL(i,location.origin)}),[...a,s])}const yn=Symbol();const bn=Z(s)`
  overflow-x: auto;
`;function kn(i){const{previewUrl:o,components:a}=i.tool.options??{},c=i.tool.name||ae,{unstable_navigator:d}=a||{},{navigate:l,state:u}=H(),p=N(Object.fromEntries(u._searchParams||[])),h=wn(o||"/",c,p.preview||null),[f]=$((()=>{const e=i.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),m=U((()=>h.origin),[h.origin]),v=W(null),[g,w]=$(),[y,b]=$({}),k=W(),{params:x,deskParams:P,navigate:S}=gn({initialPreviewUrl:h,routerNavigate:l,routerState:u,routerSearchParams:p,previewRef:k}),[I,C]=$((()=>"published"===x.perspective?x.perspective:"previewDrafts")),[z,D]=function(e){if("published"!==e&&"previewDrafts"!==e)throw new Error(`Invalid perspective: ${e}`);const[t,n]=$({}),[r,i]=$({}),o=L(((e,t)=>{const r=t.filter((e=>"_projectId"in e&&e._projectId?(mn||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),mn=!0),!1):e));("published"===e?n:i)((e=>{const t={};for(const e of r)t[e._id]=e;return Te(e,t)?e:t}))}),[]);return[U((()=>"published"===e?[...Object.values(t)]:[...Object.values(r)]),[e,r,t]),o]}(I),[j,O]=$(!0),T=J(),M=G();R((()=>{I!==x.perspective&&S({},{perspective:"published"===I?"published":void 0})}),[x.perspective,I,S]);const[_,F]=$("connecting"),[K,B]=$("connecting"),[V,q]=$("connecting"),[X]=$((()=>new Set)),Z=L((e=>{const t=window.open(e,"_blank");t&&X.add(t)}),[X]);R((()=>{if(X.size&&g)for(const e of X)e&&"closed"in e&&!e.closed&&g.addSource(e)}),[g,X,X.size]),R((()=>{const e=v.current?.contentWindow;if(!e)return;const t=function(e){const{destroy:t,send:n}=Ze(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=Ze({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:e,targetOrigin:m,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:F,onEvent(e,t){if("overlay/focus"===e&&"id"in t)S({type:t.type,id:t.id,path:t.path});else if("overlay/navigate"===e){if(k.current!==t.url){const e=void 0===k.current;k.current=t.url,S(e?{}:{id:void 0,type:void 0},{preview:t.url})}}else"overlay/toggle"===e&&O(t.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:B,onEvent(e,t){if("loader/documents"===e&&t.projectId===T&&t.dataset===M)D(t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===T&&t.dataset===M){if("number"==typeof t.heartbeat&&t.heartbeat<oe)throw new Error(`Loader query listen heartbeat interval must be at least ${oe}ms`);b((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:t.heartbeat??!1}};var n,r}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:q,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===T&&t.dataset===M&&D(t.perspective,t.documents)}}]});return w(t),()=>{t.destroy(),w(void 0)}}),[M,T,D,S,m]),R((()=>{const e=setInterval((()=>A((()=>b((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),oe);return()=>clearInterval(e)}),[]);const Q=L((e=>{S({path:r.toString(e)},{},!0)}),[S]),Y=L((e=>{const t=new URL(e,h.origin),n=t.pathname+t.search;t.origin===h.origin&&n!==x.preview&&S({id:void 0,path:void 0},{preview:n})}),[h,x,S]),ee=L((e=>{S({},e)}),[S]);R((()=>{x.id&&x.path?g?.send("overlays","presentation/focus",{id:x.id,path:x.path}):g?.send("overlays","presentation/blur",void 0)}),[g,x.id,x.path]),R((()=>{k.current&&x.preview&&k.current!==x.preview&&(k.current=x.preview,"connected"!==_&&v.current?v.current.src=`${m}${x.preview}`:g?.send("overlays","presentation/navigate",{url:x.preview,type:"replace"}))}),[g,_,m,x.preview]);const te=L((()=>g?.send("overlays","presentation/toggleOverlay",void 0)),[g]),[ne,re]=$(null);R((()=>{const e=e=>{rt(e)&&te()},t=e=>{rt(e)&&te(),nt(["mod","\\"],e)&&te()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[te]);const[ie,se]=$(null),[{navigatorEnabled:ce,toggleNavigator:de},le]=Xt({unstable_navigator:d}),ue=W(x.id);return R((()=>{x.rev&&ue.current&&x.id!==ue.current&&S({},{rev:void 0}),ue.current=x.id})),t(n,{children:[e(Qt,{deskParams:P,devMode:f,name:c,params:x,navigate:S,children:e(Gt,{navigate:S,children:e(Zt,{params:x,children:e(bn,{height:"fill",children:t(Jt,{children:[e(le,{}),e(Lt,{id:"preview",minWidth:325,defaultSize:ce?50:75,order:3,children:e(s,{direction:"column",flex:1,height:"fill",ref:se,children:e(E,{element:ie,children:e(cn,{initialUrl:h,navigatorEnabled:ce,onPathChange:Y,openPopup:Z,overlayEnabled:j,params:x,perspective:I,ref:v,setPerspective:C,targetOrigin:m,toggleNavigator:de,toggleOverlay:te,loadersConnection:K,overlaysConnection:_,previewKitConnection:V})})})}),e(Rt,{order:4}),e(Lt,{id:"content",minWidth:325,order:5,children:e(he,{documentId:x.id,setDisplayedDocument:re,children:e(bt,{refs:z,deskParams:P,documentId:x.id,documentType:x.type,onDeskParams:ee,onFocusPath:Q,previewUrl:x.preview})})})]})})})})}),g&&e(xt,{channel:g,liveQueries:y,perspective:I,liveDocument:ne,documentsOnPage:z})]})}export{kn as default};//# sourceMappingURL=PresentationTool-WsqyCX7G.js.map
