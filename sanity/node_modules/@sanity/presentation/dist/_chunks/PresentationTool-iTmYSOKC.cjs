"use strict";var e=require("react/jsx-runtime"),t=require("@sanity/client/csm"),n=require("@sanity/ui"),r=require("react"),i=require("sanity"),o=require("sanity/router"),s=require("styled-components"),a=require("./index-gvCWCnr7.cjs"),c=require("sanity/desk"),d=require("./DisplayedDocumentBroadcaster-76msq6-g.cjs"),l=require("mendoza"),u=require("mnemonist/lru-cache-with-delete"),p=require("@sanity/icons"),f=require("@sanity/preview-url-secret/create-secret"),h=require("@sanity/preview-url-secret/without-secret-search-params"),m=require("framer-motion"),v=require("fast-deep-equal"),g=require("@sanity/preview-url-secret/define-preview-url"),x=require("suspend-react");function w(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var y=w(s),b=w(u),j=w(v);let k;const S=new Uint8Array(16);function C(){if(!k&&(k="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!k))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return k(S)}const P=[];for(let e=0;e<256;++e)P.push((e+256).toString(16).slice(1));var E={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function I(e,t,n){if(E.randomUUID&&!t&&!e)return E.randomUUID();const r=(e=e||{}).random||(e.rng||C)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return P[e[t+0]]+P[e[t+1]]+P[e[t+2]]+P[e[t+3]]+"-"+P[e[t+4]]+P[e[t+5]]+"-"+P[e[t+6]]+P[e[t+7]]+"-"+P[e[t+8]]+P[e[t+9]]+"-"+P[e[t+10]]+P[e[t+11]]+P[e[t+12]]+P[e[t+13]]+P[e[t+14]]+P[e[t+15]]}(r)}const D=1e3,L=1e3,M=500,z=["handshake/syn","handshake/syn-ack","handshake/ack"],T=e=>z.some((t=>t===e)),R=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function U(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(T(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),d(e,"handshake/ack",{id:e.id}))}}const o=t=>{const{data:r}=t;if(!T(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),l(t,"channel/response",{responseTo:r.id},!1)}}};function s(t){if(R(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function a(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,a(t),function(e){e.id=I(),e.interval=window.setInterval((()=>{d(e,"handshake/syn",{id:e.id})}),M)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(a(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:L;e.heartbeat=window.setInterval((()=>{l(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{l(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),a(t))}function d(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:I(),to:n.config.id,type:r};try{t?.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error(`Failed to postMessage '${o.id}' on '${e.id}'`)}}function l(n,r,i,o=!0){const s=I();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const a={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:s,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{a.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${a.type}' on client '${e.id}' (ID: '${a.id}').`))}),D),o=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===a.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{t?.postMessage(a,{targetOrigin:e.targetOrigin})}catch(t){throw new Error(`Failed to postMessage '${a.id}' on client '${e.id}'`)}}return window.addEventListener("message",s,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(l(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",s,!1),n.forEach((e=>{a(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");l(i,t,r)}))}}}const $=/^([A-Za-z]+):([0-9]+)$/,O=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,F=/^([A-Za-z]+):([a-z0-9]+)$/;const B={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function W(e,t){return e.every((e=>B[e]?t[B[e]]:t.key===e.toUpperCase()))}function A(e){return"Alt"===e.key}function q(e){if(void 0===e)return;const t=decodeURIComponent(e)?.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function _(e){if(void 0!==e)return t.studioPath.toString(function(e){const t=[];for(const n of e.split(".")){const e=$.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=O.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=F.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function N(t){const{children:r,message:i,onRetry:o,onContinueAnyway:s,...a}=t,c=e.jsx(n.Button,{fontSize:1,mode:"ghost",onClick:o,text:"Retry"}),d=e.jsx(n.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:s,text:"Continue anyway"});return e.jsx(n.Card,{height:"fill",...a,children:e.jsx(n.Flex,{align:"center",height:"fill",justify:"center",children:e.jsx(n.Container,{padding:4,sizing:"border",width:0,children:e.jsxs(n.Stack,{space:4,children:[e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Text,{size:1,weight:"semibold",children:"An error occured"}),e.jsx(n.Text,{muted:!0,size:1,children:i})]}),r,o&&s?e.jsxs(n.Inline,{space:2,children:[c,d]}):o?e.jsx(n.Box,{children:c}):s?e.jsx(n.Box,{children:d}):null]})})})})}function K(){const e=r.useContext(a.P);if(!e)throw new Error("Presentation context is missing");return e}function V(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const J=r.forwardRef((function(t,n){const{deskParams:r,params:i}=K();return e.jsx(o.StateLink,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),G=r.forwardRef((function(t,n){const{documentId:r,documentType:i,...s}=t;return e.jsx(o.StateLink,{...s,ref:n,state:{id:r,type:i},title:void 0})}));function H(t){const{children:n,params:s,onDeskParams:a,previewUrl:d,refs:l}=t,{state:u,resolvePathFromState:p}=o.useRouter(),f=i.useUnique(Object.fromEntries(u._searchParams||[])),h=r.useCallback((e=>`${p(u)}${V({...f,...e})}`),[p,f,u]),m=r.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:s,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,s=l?.find((e=>i.getPublishedId(e._id)===n));return s?e.jsx(o.StateLink,{...r,state:{id:s._id,type:s._type,_searchParams:Object.entries({preview:d})}}):e.jsx("div",{...r})},BackLink:J,ReferenceChildLink:G,ParameterizedLink:()=>e.jsx(e.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{a({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:h})),[h,a,s,d,l]);return e.jsx(c.PaneRouterContext.Provider,{value:m,children:n})}const X=y.default(c.PaneLayout)`
  height: 100%;
`,Z=y.default(n.Flex)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,Q=y.default(n.Code)`
  white-space: pre-wrap;
`;function Y(t){const{onDeskParams:i,previewUrl:o,refs:s}=t,{devMode:a}=K(),d=r.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:s.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[s]),[l,u]=r.useState(null),p=r.useCallback((()=>u(null)),[]),[f]=r.useState((()=>({})));return r.useEffect((()=>u(null)),[s]),l?e.jsx(N,{flex:1,message:"Could not render the document list",onRetry:p,children:a&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(Q,{size:1,children:l.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:u,children:e.jsx(X,{children:e.jsx(c.DeskToolProvider,{children:e.jsx(H,{params:f,onDeskParams:i,previewUrl:o,refs:s,children:e.jsx(Z,{direction:"column",flex:1,children:e.jsx(c.DocumentListPane,{index:0,itemId:"$root",pane:d,paneKey:"$root"})})})})})})}function ee(t){const{onDeskParams:n,previewUrl:i,refs:o}=t,s=r.useMemo((()=>o.map((({_id:e,_type:t})=>({_id:q(e),_type:t})))),[o]);return e.jsx(Y,{onDeskParams:n,previewUrl:i,refs:s})}const te=y.default(n.Code)`
  white-space: pre-wrap;
`;function ne(t){const{documentId:i,documentType:o,params:s,onDeskParams:a,onFocusPath:d}=t,{devMode:l}=K(),u=r.useMemo((()=>({id:i,options:{id:i,type:o},title:"",type:"document"})),[i,o]),[p,f]=r.useState(null),h=r.useCallback((()=>f(null)),[]);r.useEffect((()=>{f(null)}),[i,o,s]);const{setLayoutCollapsed:m}=c.useDeskTool(),v=r.useCallback((()=>m(!0)),[m]),g=r.useCallback((()=>m(!1)),[m]);return p?e.jsx(N,{flex:1,message:"Could not render the document editor",onRetry:h,children:l&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(te,{size:1,children:p.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:f,children:e.jsx(c.PaneLayout,{style:{height:"100%"},onExpand:g,onCollapse:v,children:e.jsx(H,{onDeskParams:a,params:s,children:e.jsx(c.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:u,onFocusPath:d})})})})}function re(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s}=t;return e.jsx(c.DeskToolProvider,{children:e.jsx(ne,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:s})})}function ie(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s,previewUrl:a,refs:c}=t;return r&&i?e.jsx(re,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s}):e.jsx(ee,{onDeskParams:o,previewUrl:a,refs:c})}function oe(e){return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}function se(t){const{liveDocument:n,channel:o,perspective:s,liveQueries:c,documentsOnPage:d}=t,[l]=r.useState((()=>new b.default(a.L))),u=i.useClient({apiVersion:"2023-10-16"}),p=r.useMemo((()=>u.config()),[u]),f=r.useMemo((()=>u.withConfig({resultSourceMap:"withKeyArraySelector"})),[u]);r.useEffect((()=>{if(o){const{projectId:e,dataset:t}=p;o.send("loaders","loader/perspective",{projectId:e,dataset:t,perspective:s})}}),[o,p,s]);const h=r.useMemo((()=>{const e=d.map((({_id:e})=>e)),t=[...new Set(e)],n=l.capacity;return t.length>=n&&(t.length=n),t}),[l.capacity,d]),[m,v]=r.useState(0);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{cache:l,client:f,turboIds:h,setDocumentsCacheLastUpdated:v}),Object.entries(c).map((([t,{query:r,params:i,perspective:a}])=>e.jsx(de,{cache:l,projectId:p.projectId,dataset:p.dataset,perspective:a,query:r,params:i,channel:o,client:f,refreshInterval:s?2e3:0,liveDocument:n,documentsCacheLastUpdated:m},`${t}${a}`)))]})}const ae=r.memo((function(t){const{cache:n,client:i,turboIds:o,setDocumentsCacheLastUpdated:s}=t,[c,d]=r.useState([]);return r.useEffect((()=>{const e=new Set(c.flat()),t=new Set;for(const r of o)e.has(r)||n.has(r)||t.add(r);const r=[...t].slice(0,a.a);0!==r.length&&d((e=>[...e.slice(-a.a),r]))}),[c,n,o]),r.useEffect((()=>{const e=i.listen("*",{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe((e=>{if("mutation"===e.type&&"disappear"===e.transition&&n.delete(e.documentId)&&s(Date.now()),"mutation"!==e.type||!e.effects?.apply?.length)return;const t=n.peek(e.documentId);if(t){const r={...t};delete r._rev;const i=l.applyPatch(r,e.effects.apply);n.set(e.documentId,i),s(Date.now())}}));return()=>e.unsubscribe()}),[n,i,s]),e.jsx(e.Fragment,{children:c.map((t=>e.jsx(ce,{cache:n,client:i,ids:t,setDocumentsCacheLastUpdated:s},JSON.stringify(t))))})})),ce=r.memo((function(e){const{client:t,cache:n,ids:i,setDocumentsCacheLastUpdated:o}=e;return r.useEffect((()=>{const e=i.filter((e=>!n.has(e)));0!==e.length&&t.getDocuments(e).then((e=>{for(const t of e)t&&t?._id&&(n.set(t._id,t),o(Date.now()))}),console.error)}),[n,t,i,o]),null}));function de(e){const{cache:t,projectId:n,dataset:i,perspective:o,query:s,client:a,refreshInterval:c,liveDocument:d,channel:l,documentsCacheLastUpdated:u}=e,p=function(e){const t=r.useMemo((()=>JSON.stringify(e||{})),[e]);return r.useMemo((()=>JSON.parse(t)),[t])}(e.params),f=function(e){const{cache:t,liveDocument:n,client:i,refreshInterval:o,query:s,params:a,perspective:c,documentsCacheLastUpdated:d}=e,[l,u]=r.useState(null),{projectId:p,dataset:f}=r.useMemo((()=>{const{projectId:e,dataset:t}=i.config();return{projectId:e,dataset:t}}),[i]),[h,m]=r.useState(null);if(h)throw h;const[v,g]=function(e){const{refreshInterval:t}=e,n=function(){const[e,t]=r.useState(!1);r.useEffect((()=>{t(navigator.onLine);const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}),[]);const n=r.useSyncExternalStore(oe,(()=>document.visibilityState),(()=>"hidden"));return!e||"hidden"===n}(),[i,o]=r.useState("hit"),s=r.useCallback((()=>(o("inflight"),()=>o("hit"))),[]);return r.useEffect((()=>{if(!t||"hit"!==i)return;const e=setTimeout((()=>o("stale")),t);return()=>clearTimeout(e)}),[t,i]),r.useEffect((()=>{if("hit"!==i)return;const e=()=>o("stale");return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)}),[t,i]),r.useEffect((()=>{n&&"hit"===i&&o("stale"),n||"stale"!==i||o("refresh")}),[n,i]),[i,s]}({refreshInterval:o}),x="refresh"===v||"inflight"===v;return r.useEffect((()=>{if(!x)return;let e=!1,t=!1;const n=new AbortController;async function r(){const{signal:r}=n;t=!0;const{result:o,resultSourceMap:d}=await i.fetch(s,a,{tag:"presentation-loader",signal:r,perspective:c,filterResponse:!1});t=!1,r.aborted||(u({result:o,resultSourceMap:d}),e=!0)}const o=g();return r().catch((e=>{t=!1,"AbortError"!==e.name&&m(e)})).finally(o),()=>{e||t||n.abort()}}),[i,f,n,a,c,p,s,x,g]),r.useMemo((()=>d&&l?.resultSourceMap?{result:ue(t,n,l.result,c,l.resultSourceMap),resultSourceMap:l.resultSourceMap}:l),[t,d,n,c,l])}({cache:t,client:a,liveDocument:d,params:p,perspective:o,query:s,refreshInterval:c,documentsCacheLastUpdated:u}),h=f?.result,m=f?.resultSourceMap;return r.useEffect((()=>{m&&l.send("loaders","loader/query-change",{projectId:n,dataset:i,perspective:o,query:s,params:p,result:h,resultSourceMap:m})}),[l,i,p,o,n,s,h,m]),null}ce.displayName="GetDocuments";let le=!1;function ue(e,n,r,i,o){if("raw"===i)throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return t.applySourceDocuments(r,o,(r=>{if(!r._projectId)return n?._id&&t.getPublishedId(n._id)===t.getPublishedId(r._id)?n:e.get(r._id);le||(console.warn("Cross dataset references are not supported yet, ignoring source document",r),le=!0)}),((e,{previousValue:t})=>"number"==typeof e&&"string"==typeof t?`${e}`:e),i)}const pe=r.createContext(null);pe.displayName="PanelsContext";const fe=y.default.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,he=function({children:t,defaultSize:n=null,id:i,minWidth:o,maxWidth:s,order:a=0}){const c=r.useContext(pe);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:d,registerElement:l,unregisterElement:u}=c,p=d(i);return r.useLayoutEffect((()=>(l(i,{id:i,type:"panel",defaultSize:n,maxWidth:s??null,minWidth:o??0,order:a}),()=>{u(i)})),[i,n,a,s,o,l,u]),e.jsx(fe,{style:p,children:t})};const me=y.default.div`
  position: relative;
`,ve=y.default.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,ge=function({id:t,order:n,disabled:i=!1}){const o=r.useRef(null),s=r.useContext(pe);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const a=function(e){return r.useRef(e||I()).current}(t),{activeResizer:c,drag:d,startDragging:l,stopDragging:u,registerElement:p,unregisterElement:f}=s,h=c===a;if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const m=r.useCallback((e=>{l(a,e.nativeEvent)}),[a,l]),v=r.useCallback((e=>{d(a,e)}),[a,d]),g=r.useCallback((()=>{o.current.blur(),u()}),[u]);return r.useEffect((()=>{if(h&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,h,v,g]),r.useLayoutEffect((()=>(p(a,{id:a,order:n,type:"resizer",el:o}),()=>{f(a)})),[a,n,p,f]),e.jsx(me,{onMouseDown:m,ref:o,children:e.jsxs(ve,{$disabled:i,children:[e.jsx("span",{}),e.jsx("span",{})]})})};function xe(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const we="presentation/panels",ye=()=>JSON.parse(localStorage.getItem(we)||"{}"),be=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function je(){return r.useMemo((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(we,JSON.stringify(e))})({...ye(),[be(e)]:t})};return{get:e=>ye()[be(e)],set:e,setDebounced:xe(e,100)}}),[])}function ke(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,s=i/n*100;return Math.min(o,Math.max(s,t))}function Se(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Ce(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Pe(e){return"panel"===e.type}function Ee(e){return"resizer"===e.type}function Ie(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function De(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],s=i[t],a=ke(r,s,n);s!=a&&(o+=s-a,i[t]=a)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:s,minWidth:a}=r;a=a/n*100,null!=s&&(s=s/n*100);const c=Math.min(null!=s?s:100,Math.max(a,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}const Le=y.default.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Me=function({children:t}){const n=r.useRef(null),[i,o]=r.useState(new Map),s=r.useMemo((()=>Ie(i).filter(Pe)),[i]),[a,c]=r.useState([]),[d,l]=r.useState(null),u=r.useRef({elements:i,panels:s,widths:a}),p=r.useCallback((e=>({flexGrow:Se(s,e,a),pointerEvents:null===d?void 0:"none"})),[d,s,a]),f=r.useCallback(((e,t)=>{o((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=r.useCallback((e=>{o((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=r.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=r.useCallback(((e,t)=>{const n=Ie(i),r=n.findIndex((t=>t.id===e)),o=i.get(e);if(!o||!Ee(o))return;const s=o.el.current;s&&(m.current={resizerIndex:r,panelBefore:n.reduce(((e,t,n)=>Pe(t)&&n<r?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Pe(t)&&n>r?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Ce(t,s),resizerRect:s.getBoundingClientRect(),widths:u.current.widths},l(e))}),[i]),g=r.useCallback((()=>{l(null)}),[]),x=r.useCallback(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:r,dragOffset:o,panelBefore:s,panelAfter:a,resizerRect:d}=m.current;if(null==s||null==a)return;const l=i.get(e);if(!l||!Ee(l))return;const p=l.el.current;if(!p)return;const f=Ce(t,p,o,d);if(0===f)return;const{widths:h}=u.current,v=function(e,t,n,r,i,o){const{panels:s,widths:a}=i,{widths:c}=o,d=c||a,l=[...d];{const i=e<0?r:n,o=d[s.findIndex((e=>e.id===i.id))],a=ke(i,o+Math.abs(e),t);if(o===a)return d;e=e<0?o-a:a-o}let u=0,p=e<0?n:r,f=s.findIndex((e=>e.id===p.id));for(;;){const n=s[f],r=d[f],i=ke(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,l[f]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--f<0)break}else if(++f>=s.length)break}return 0===u?d:(p=e<0?r:n,f=s.findIndex((e=>e.id===p.id)),l[f]=d[f]+u,l)}(f/n.current.getBoundingClientRect().width*100,r,s,a,u.current,m.current),g=h.some(((e,t)=>e!==v[t]));g&&c(v)}),[i]);r.useLayoutEffect((()=>{u.current.elements=i,u.current.panels=s,u.current.widths=a}),[i,s,a]);const w=je();r.useLayoutEffect((()=>{const{widths:e}=u.current;if(e.length===s.length)return;const t=w.get(s);if(t){const e=De(s,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(s);c(n)}),[w,s]),r.useEffect((()=>{a.length&&w.setDebounced(s,a)}),[w,s,a]),r.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=u.current,n=De(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&c(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const y=r.useMemo((()=>({activeResizer:d,drag:x,getPanelStyle:p,registerElement:f,startDragging:v,stopDragging:g,unregisterElement:h})),[d,x,p,f,v,g,h]);return e.jsx(pe.Provider,{value:y,children:e.jsx(Le,{ref:n,children:t})})},ze=function(t){const{children:n,navigate:i}=t,o=r.useCallback((e=>{i({},{preview:e})}),[i]),s=r.useMemo((()=>o),[o]);return e.jsx(a.b.Provider,{value:s,children:n})};function Te(t){const{unstable_navigator:n}=t,i=!!n?.component,[o,s]=function(e,t){const[n,i]=r.useState((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return r.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,i]}("presentation/navigator",i),a=!!i&&o,c=r.useMemo((()=>{if(i)return()=>s((e=>!e))}),[i,s]),d=r.useCallback((function(){return e.jsx(e.Fragment,{children:a&&e.jsx(Re,{...n})})}),[a,n]);return[{navigatorEnabled:a,toggleNavigator:c},d]}const Re=r.memo((function(t){const{minWidth:n,maxWidth:r,component:i}=t,o=null!=n&&null!=r&&n===r;return e.jsxs(e.Fragment,{children:[e.jsx(he,{id:"navigator",minWidth:n,maxWidth:r,order:1,children:e.jsx(i,{})}),e.jsx(ge,{order:2,disabled:o})]})})),Ue=function(t){const{children:n,params:i}=t,o=r.useMemo((()=>i),[i]);return e.jsx(a.c.Provider,{value:o,children:n})},$e=function(t){const{children:n,deskParams:i,devMode:o,name:s,navigate:c,params:d}=t,l=r.useMemo((()=>({deskParams:i,devMode:o,name:s,navigate:c,params:d})),[i,o,s,c,d]);return e.jsx(a.P.Provider,{value:l,children:n})},Oe=m.motion(y.default.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),Fe=function(t){const{basePath:o="/"}=i.useActiveWorkspace()?.activeWorkspace||{},{fontSize:s=1,onChange:a,origin:c,padding:d=3,value:l}=t,u=r.useRef(null),[f,h]=r.useState(void 0),[m,v]=r.useState(void 0),g=r.useCallback((e=>{h(e.currentTarget.value)}),[]),x=r.useCallback((e=>{if("Enter"===e.key){if(void 0===f)return;const e=f.startsWith("/")||""===f?`${c}${f}`:f;if(!e.startsWith(c+"/")&&e!==c)return void v(`URL must start with ${c}`);if(!c&&(e.startsWith(`${o}/`)||e===o))return void v(`URL can't have the same base path as the Studio ${o}`);const t=e===c?c+"/":e;v(void 0),h(void 0),a(t.slice(c.length)),u.current?.blur()}"Escape"===e.key&&(v(void 0),h(void 0))}),[o,a,c,f]),w=r.useCallback((()=>{v(void 0),h(void 0)}),[]);r.useEffect((()=>{v(void 0),h(void 0)}),[c,l]);const y=r.useMemo((()=>({icon:p.ResetIcon})),[]);return e.jsx(e.Fragment,{children:e.jsx(n.TextInput,{clearButton:m?y:void 0,customValidity:m,fontSize:s,onBlur:w,onClear:()=>{v(void 0),h(c+l)},onChange:g,onKeyDownCapture:x,padding:d,style:{zIndex:1},radius:2,ref:u,space:d,value:void 0===f?`${c}${l}`:f})})},Be=m.motion(n.Flex),We=y.default(n.Switch)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,Ae={previewDrafts:"Drafts",published:"Published",raw:"Raw"},qe="caution",_e="positive",Ne={previewDrafts:p.EditIcon,published:p.PublishIcon,raw:p.DatabaseIcon},Ke=r.forwardRef((function(t,o){const{initialUrl:s,targetOrigin:c,navigatorEnabled:d,onPathChange:l,openPopup:u,overlayEnabled:f,params:v,perspective:g,setPerspective:x,toggleNavigator:w,toggleOverlay:y,loadersConnection:b,overlaysConnection:j,previewKitConnection:k}=t,{devMode:S}=K(),[C,P]=r.useState("desktop"),E=n.usePrefersReducedMotion(),I=r.useCallback((()=>P("desktop")),[P]),D=r.useCallback((()=>P("mobile")),[P]),[L,M]=r.useState(!0),[z,T]=r.useState(!1),[R,U]=r.useState(!1),[$,O]=r.useState(!1),F=L||R||"connecting"===j,B=r.useMemo((()=>c===location.origin?"":c),[c]),W=r.useCallback((()=>{"function"!=typeof o&&o?.current&&(o.current.src=`${c}${v.preview||"/"}`,U(!0))}),[v.preview,c,o]),A=r.useCallback((()=>{"function"!=typeof o&&o?.current&&(o.current.src=s.toString(),U(!0))}),[o,s]),q=r.useCallback((()=>{V(!0)}),[]),[_,V]=r.useState(!1),[J,G]=r.useState(!1);r.useEffect((()=>{if(!(L||R||"connecting"!==j&&"reconnecting"!==j)){const e=setTimeout((()=>{G(!0)}),1e3);return()=>clearTimeout(e)}}),[j,L,R,G]),r.useEffect((()=>{if(!L&&!R&&J){if("connected"===j&&(O(!1),G(!1),T(!1),V(!1)),"connecting"===j){const e=setTimeout((()=>{T(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")}),a.M);return()=>clearTimeout(e)}if("reconnecting"===j){const e=setTimeout((()=>{T(!0),O(!0)}),a.M);return()=>clearTimeout(e)}"disconnected"===j&&O(!0)}}),[L,j,R,J]);const H=r.useMemo((()=>{const e=new URL(v.preview||"/",c),{pathname:t,search:n}=h.withoutSecretSearchParams(e);return`${t}${n}`}),[v.preview,c]),X=r.useCallback((()=>{M(!1),U(!1)}),[]);return e.jsx(m.MotionConfig,{transition:E?{duration:0}:void 0,children:e.jsxs(n.TooltipDelayGroupProvider,{delay:1e3,children:[e.jsx(n.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:e.jsxs(n.Flex,{align:"center",gap:2,style:{minHeight:0},children:[w&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Toggle navigator",fontSize:1,icon:p.PanelLeftIcon,mode:"bleed",onClick:w,padding:3,selected:d})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsxs(n.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:[e.jsx(n.Box,{padding:1,children:e.jsx(n.Text,{size:1,children:f?"Disable edit overlay":"Enable edit overlay"})}),e.jsx(n.Box,{paddingY:1,children:e.jsx(i.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e.jsx(n.Card,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:f?"positive":void 0,children:e.jsxs(n.Flex,{align:"center",gap:2,children:[e.jsx("div",{style:{margin:-2},children:e.jsx(We,{checked:f,onChange:y,disabled:F})}),e.jsx(n.Box,{children:e.jsx(n.Text,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),S&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:R?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Refresh preview",fontSize:1,icon:p.RefreshIcon,mode:"bleed",loading:R,onClick:W,padding:3})}),e.jsx(n.Box,{flex:1,children:e.jsx(Fe,{onChange:l,origin:B,value:H})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:p.ShareIcon,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e.jsx(n.Menu,{children:e.jsx(Xe,{initialUrl:s,openPopup:u,previewLocationOrigin:B,previewLocationRoute:H})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:p.ChevronDownIcon,mode:"bleed",padding:3,space:2,text:Ae[g],loading:F||"connecting"===b&&"connected"!==k,disabled:"connected"!==b}),id:"perspective-menu",menu:e.jsxs(n.Menu,{style:{maxWidth:240},children:[e.jsx(n.MenuItem,{fontSize:1,onClick:()=>x("previewDrafts"),padding:3,pressed:"previewDrafts"===g,tone:qe,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Ne.previewDrafts)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Ae.previewDrafts}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===g?1:0},children:e.jsx(p.CheckmarkIcon,{})})})]})}),e.jsx(n.MenuItem,{fontSize:1,onClick:()=>x("published"),padding:3,pressed:"published"===g,tone:_e,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Ne.published)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Ae.published}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with published content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"published"===g?1:0},children:e.jsx(p.CheckmarkIcon,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsxs(n.Flex,{align:"center",flex:"none",gap:1,children:[e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Full viewport",fontSize:1,icon:p.DesktopIcon,mode:"bleed",onClick:I,padding:3,selected:"desktop"===C})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Narrow viewport",fontSize:1,icon:p.MobileDeviceIcon,mode:"bleed",onClick:D,padding:3,selected:"mobile"===C})})]})]})}),e.jsx(n.Card,{flex:1,tone:"transparent",children:e.jsxs(n.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===C?0:2,sizing:"border",style:{position:"relative",cursor:F?"wait":void 0},children:[e.jsx(m.AnimatePresence,{children:$||L||R||!J||_?!L&&!F||_?$&&!_?e.jsx(Be,{initial:"initial",animate:"animate",exit:"exit",variants:Ge,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e.jsx(N,{flex:1,message:"Could not connect to the preview",onRetry:A,onContinueAnyway:q,children:S&&e.jsxs(e.Fragment,{children:["connected"!==j&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Overlay connection status"}),e.jsx(n.Code,{size:1,children:j})]})}),"connected"!==b&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Loader connection status"}),e.jsx(n.Code,{size:1,children:b})]})})]})})}):null:e.jsx(Be,{initial:"initial",animate:"animate",exit:"exit",variants:Je,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:e.jsxs(n.Flex,{style:{...Ve[C]},justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:"Loading…"})]})}):e.jsx(Be,{initial:"initial",animate:"animate",exit:"exit",variants:Je,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:z?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:e.jsxs(n.Flex,{style:{...Ve[C]},justify:"center",align:"center",direction:"column",gap:4,children:[z&&e.jsx(n.Button,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e.jsx(n.Card,{radius:2,tone:z?"caution":"inherit",padding:4,shadow:1,children:e.jsxs(n.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:z?e.jsx(e.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),z&&e.jsx(n.Button,{fontSize:1,tone:"critical",onClick:q,text:"Continue anyway"})]})})}),e.jsx(Oe,{ref:o,style:{pointerEvents:F&&!_?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:He,animate:[!L&&!F||_?"active":"background",R?"reloading":"idle",C,J&&!_?"timedOut":""],onLoad:X})]})})]})})})),Ve={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Je={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Ge={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},He={desktop:{...Ve.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Ve.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function Xe(t){const{initialUrl:i,openPopup:o,previewLocationOrigin:s,previewLocationRoute:a}=t,c=r.useCallback((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return e.jsxs(e.Fragment,{children:[e.jsx(Ze,{initialUrl:i,previewLocationOrigin:s,previewLocationRoute:a}),e.jsx(n.MenuItem,{icon:p.LaunchIcon,text:"Open preview",as:"a",href:`${s}${a}`,onClick:c,rel:"opener",target:"_blank"})]})}function Ze(t){const{initialUrl:o,previewLocationOrigin:s,previewLocationRoute:c}=t,{push:d}=n.useToast(),l=i.useClient({apiVersion:a.A}),u=i.useCurrentUser(),[m,v]=r.useState(!1);return e.jsx(n.MenuItem,{disabled:m,onClick:()=>{if(!navigator?.clipboard)return d({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;v(!0);let t=`${s}${c}`;const n=()=>{d({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),v(!1)},r=e=>{d({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),v(!1)};if(h.hasSecretSearchParams(o)&&"undefined"!=typeof ClipboardItem){const i="text/plain",s=new ClipboardItem({[i]:(async()=>{e=d({closable:!0,title:"Copying URL to clipboard…"});const n=await f.createPreviewSecret(l,"@sanity/presentation","undefined"==typeof window?"":location.href,u?.id),r=h.setSecretSearchParams(o,n.secret,c);return t=r.toString(),new Blob([t],{type:i})})()});navigator.clipboard.write([s]).then(n).catch(r)}else navigator.clipboard.writeText(t).then(n).catch(r)},text:"Copy link",icon:p.CopyIcon})}let Qe=!1;function Ye(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function et({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:i,previewRef:o}){const s=r.useMemo((()=>{const{id:t,path:r,type:o}={id:q((s=n).id),path:_(s.path),type:s.type};var s;return{id:t,type:o,path:r,preview:i.preview||`${e.pathname}${e.search}`,perspective:i.perspective,inspect:i.inspect,rev:i.rev,since:i.since,template:i.template,view:i.view,pathKey:i.pathKey,instruction:i.instruction,comment:i.comment}}),[n,i,e]),a=r.useMemo((()=>Ye({inspect:s.inspect,path:s.path,rev:s.rev,since:s.since,template:s.template,view:s.view,pathKey:s.pathKey,instruction:s.instruction,comment:s.comment})),[s.inspect,s.path,s.rev,s.since,s.template,s.view,s.pathKey,s.instruction,s.comment]),c=r.useRef(n);r.useEffect((()=>{c.current=n}),[n]);return{deskParams:a,navigate:r.useMemo((()=>xe(((e,n={},r)=>{const{_searchParams:i,...s}=c.current,a=(i||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),d=Ye({...s,...e}),l=Ye({...a,...n});d._searchParams=Object.entries(l).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const u=r??l.preview===o.current;t(d,{replace:u})}),50)),[t,o]),params:s}}function tt(e,t,n){const o=i.useClient({apiVersion:a.A}),s=i.useActiveWorkspace(),c=s?.activeWorkspace?.basePath||"/",d=function(e,t,n){const o=i.useCurrentUser();return r.useMemo((()=>["@sanity/presentation",t,n,e,o?.id,nt]),[t,o?.id,e,n])}(t,c,s?.activeWorkspace?.name||"default"),l=function(e,t){const n=i.useClient({apiVersion:a.A}),o=i.useCurrentUser(),[s,c]=r.useState(""),d=e?x.suspend((async()=>await f.createPreviewSecret(n,"@sanity/presentation","undefined"==typeof window?"":location.href,o?.id)),[...t,s]):null;return r.useEffect((()=>{if(!d)return;const e=setTimeout((()=>{r.startTransition((()=>c(d.expiresAt.toString())))}),d.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[d]),d?.secret||null}("object"==typeof e||"function"==typeof e,d);return x.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${c}/`)&&r.pathname!==c?r:t}const t="object"==typeof e?g.definePreviewUrl(e):e,r=await t({client:o,previewUrlSecret:l,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:c});return new URL(r,location.origin)}),[...d,l])}const nt=Symbol();const rt=y.default(n.Flex)`
  overflow-x: auto;
`;exports.default=function(s){const{previewUrl:c,components:l}=s.tool.options??{},u=s.tool.name||a.D,{unstable_navigator:p}=l||{},{navigate:f,state:h}=o.useRouter(),m=i.useUnique(Object.fromEntries(h._searchParams||[])),v=tt(c||"/",u,m.preview||null),[g]=r.useState((()=>{const e=s.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:"undefined"!=typeof window&&"localhost"===window.location.hostname})),x=r.useMemo((()=>v.origin),[v.origin]),w=r.useRef(null),[y,b]=r.useState(),[k,S]=r.useState({}),C=r.useRef(),{params:P,deskParams:E,navigate:I}=et({initialPreviewUrl:v,routerNavigate:f,routerState:h,routerSearchParams:m,previewRef:C}),[D,L]=r.useState((()=>"published"===P.perspective?P.perspective:"previewDrafts")),[M,z]=function(e){if("published"!==e&&"previewDrafts"!==e)throw new Error(`Invalid perspective: ${e}`);const[t,n]=r.useState({}),[i,o]=r.useState({}),s=r.useCallback(((e,t)=>{const r=t.filter((e=>"_projectId"in e&&e._projectId?(Qe||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),Qe=!0),!1):e));("published"===e?n:o)((e=>{const t={};for(const e of r)t[e._id]=e;return j.default(e,t)?e:t}))}),[]);return[r.useMemo((()=>"published"===e?[...Object.values(t)]:[...Object.values(i)]),[e,i,t]),s]}(D),[T,R]=r.useState(!0),$=i.useProjectId(),O=i.useDataset();r.useEffect((()=>{D!==P.perspective&&I({},{perspective:"published"===D?"published":void 0})}),[P.perspective,D,I]);const[F,B]=r.useState("connecting"),[q,_]=r.useState("connecting"),[N,K]=r.useState("connecting"),[V]=r.useState((()=>new Set)),J=r.useCallback((e=>{const t=window.open(e,"_blank");t&&V.add(t)}),[V]);r.useEffect((()=>{if(V.size&&y)for(const e of V)e&&"closed"in e&&!e.closed&&y.addSource(e)}),[y,V,V.size]),r.useEffect((()=>{const e=w.current?.contentWindow;if(!e)return;const t=function(e){const{destroy:t,send:n}=U(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:s}=U({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(s),i.set(t,n),r.add(t)}}}({id:"presentation",target:e,targetOrigin:x,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:B,onEvent(e,t){if("overlay/focus"===e&&"id"in t)I({type:t.type,id:t.id,path:t.path});else if("overlay/navigate"===e){if(C.current!==t.url){const e=void 0===C.current;C.current=t.url,I(e?{}:{id:void 0,type:void 0},{preview:t.url})}}else"overlay/toggle"===e&&R(t.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:_,onEvent(e,t){if("loader/documents"===e&&t.projectId===$&&t.dataset===O)z(t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===$&&t.dataset===O){if("number"==typeof t.heartbeat&&t.heartbeat<a.d)throw new Error(`Loader query listen heartbeat interval must be at least ${a.d}ms`);S((e=>{return{...e,[(n=t.query,r=t.params,`${n}-${"string"==typeof r?r:JSON.stringify(r)}`)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:t.heartbeat??!1}};var n,r}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:K,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===$&&t.dataset===O&&z(t.perspective,t.documents)}}]});return b(t),()=>{t.destroy(),b(void 0)}}),[O,$,z,I,x]),r.useEffect((()=>{const e=setInterval((()=>r.startTransition((()=>S((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),a.d);return()=>clearInterval(e)}),[]);const G=r.useCallback((e=>{I({path:t.studioPath.toString(e)},{},!0)}),[I]),H=r.useCallback((e=>{const t=new URL(e,v.origin),n=t.pathname+t.search;t.origin===v.origin&&n!==P.preview&&I({id:void 0,path:void 0},{preview:n})}),[v,P,I]),X=r.useCallback((e=>{I({},e)}),[I]);r.useEffect((()=>{P.id&&P.path?y?.send("overlays","presentation/focus",{id:P.id,path:P.path}):y?.send("overlays","presentation/blur",void 0)}),[y,P.id,P.path]),r.useEffect((()=>{C.current&&P.preview&&C.current!==P.preview&&(C.current=P.preview,"connected"!==F&&w.current?w.current.src=`${x}${P.preview}`:y?.send("overlays","presentation/navigate",{url:P.preview,type:"replace"}))}),[y,F,x,P.preview]);const Z=r.useCallback((()=>y?.send("overlays","presentation/toggleOverlay",void 0)),[y]),[Q,Y]=r.useState(null);r.useEffect((()=>{const e=e=>{A(e)&&Z()},t=e=>{A(e)&&Z(),W(["mod","\\"],e)&&Z()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[Z]);const[ee,te]=r.useState(null),[{navigatorEnabled:ne,toggleNavigator:re},oe]=Te({unstable_navigator:p}),ae=r.useRef(P.id);return r.useEffect((()=>{P.rev&&ae.current&&P.id!==ae.current&&I({},{rev:void 0}),ae.current=P.id})),e.jsxs(e.Fragment,{children:[e.jsx($e,{deskParams:E,devMode:g,name:u,params:P,navigate:I,children:e.jsx(ze,{navigate:I,children:e.jsx(Ue,{params:P,children:e.jsx(rt,{height:"fill",children:e.jsxs(Me,{children:[e.jsx(oe,{}),e.jsx(he,{id:"preview",minWidth:325,defaultSize:ne?50:75,order:3,children:e.jsx(n.Flex,{direction:"column",flex:1,height:"fill",ref:te,children:e.jsx(n.BoundaryElementProvider,{element:ee,children:e.jsx(Ke,{initialUrl:v,navigatorEnabled:ne,onPathChange:H,openPopup:J,overlayEnabled:T,params:P,perspective:D,ref:w,setPerspective:L,targetOrigin:x,toggleNavigator:re,toggleOverlay:Z,loadersConnection:q,overlaysConnection:F,previewKitConnection:N})})})}),e.jsx(ge,{order:4}),e.jsx(he,{id:"content",minWidth:325,order:5,children:e.jsx(d.D,{documentId:P.id,setDisplayedDocument:Y,children:e.jsx(ie,{refs:M,deskParams:E,documentId:P.id,documentType:P.type,onDeskParams:X,onFocusPath:G,previewUrl:P.preview})})})]})})})})}),y&&e.jsx(se,{channel:y,liveQueries:k,perspective:D,liveDocument:Q,documentsOnPage:M})]})};//# sourceMappingURL=PresentationTool-iTmYSOKC.cjs.map
