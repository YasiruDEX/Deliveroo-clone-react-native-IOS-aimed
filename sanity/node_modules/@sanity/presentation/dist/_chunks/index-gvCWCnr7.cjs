"use strict";var e=require("react/jsx-runtime"),t=require("react"),n=require("sanity"),r=require("@sanity/icons"),o=require("@sanity/ui"),s=require("sanity/router"),i=require("rxjs");const a=r.ComposeIcon,c="presentation",u="Presentation",d=t.createContext(null),l={locations:[]};const p={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},m={positive:r.InfoOutlineIcon,caution:r.WarningOutlineIcon,critical:r.ErrorOutlineIcon};function x(s){const{documentId:a,options:x,schemaType:f,showPresentationTitle:g}=s,j=t.useContext(d),{message:y,locations:v,tone:I}=function(e){const{id:r,locate:o,type:s}=e,a=n.useDocumentStore(),[c,u]=t.useState(l);return t.useEffect((()=>{if(!o)return;const e=o({id:r,type:s},{documentStore:a}),t=(i.isObservable(e)?e:i.of(e)).subscribe((e=>u(e||l)));return()=>t.unsubscribe()}),[a,r,o,s]),c}({id:a,locate:x.locate,type:f.name}),T=v?.length||0,[C,b]=t.useState(!1),S=t.useCallback((()=>b((e=>!e))),[]),P=y||(T?e.jsxs(e.Fragment,{children:["Used on ",p[T]||T," ",1===T?e.jsx(e.Fragment,{children:"page"}):e.jsx(e.Fragment,{children:"pages"})]}):null);return 0!==T||P?e.jsx(o.Card,{padding:1,radius:3,border:!0,tone:I,children:e.jsxs("div",{style:{margin:-1},children:[!v&&e.jsxs(o.Flex,{align:"flex-start",gap:3,padding:3,children:[I&&e.jsx(o.Box,{flex:"none",children:e.jsx(o.Text,{size:1,children:t.createElement(m[I])})}),e.jsx(o.Box,{flex:1,children:e.jsxs(o.Text,{size:1,weight:"medium",children:[g&&e.jsxs(e.Fragment,{children:[x.title||u," · "]}),P]})})]}),v&&e.jsxs(e.Fragment,{children:[e.jsx(o.Card,{as:"button",onClick:S,padding:3,radius:2,tone:"inherit",children:e.jsxs(o.Flex,{gap:3,children:[e.jsx(o.Box,{flex:"none",children:e.jsx(o.Text,{size:1,children:e.jsx(r.ChevronRightIcon,{style:{transform:`rotate(${C?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e.jsx(o.Box,{flex:1,children:e.jsxs(o.Text,{size:1,weight:"medium",children:[g&&e.jsxs(e.Fragment,{children:[x.title||u," · "]}),P]})})]})}),e.jsx(o.Stack,{hidden:!C,marginTop:1,space:1,children:v.map(((t,n)=>e.jsx(h,{active:(x.name||c)===j?.name&&t.href===j?.params.preview,documentId:a,documentType:f.name,node:t,toolName:x.name||c},n)))})]})]})}):null}function h(n){const{documentId:i,documentType:a,node:c,active:u,toolName:l}=n,p=t.useContext(d),m=p?.navigate,x=s.useIntentLink({intent:"edit",params:{id:i,type:a,mode:"presentation",presentation:l,...p?.deskParams,preview:c.href}}),h=t.useCallback((()=>{m?.({},{preview:c.href})}),[c.href,m]);return t.createElement(o.Card,{...p?{}:x,as:p?"button":"a",key:c.href,onClick:h,padding:3,radius:2,pressed:u,tone:"inherit"},e.jsxs(o.Flex,{gap:3,children:[e.jsx(o.Box,{flex:"none",children:e.jsx(o.Text,{size:1,children:e.jsx(r.DesktopIcon,{})})}),e.jsxs(o.Stack,{flex:1,space:2,children:[e.jsx(o.Text,{size:1,weight:"medium",children:c.title}),e.jsx(o.Text,{muted:!0,size:1,textOverflow:"ellipsis",children:c.href})]})]}))}const f=t.createContext(null);function g(n){const{documentId:r,options:s,schemaType:i}=n,a=t.useContext(f);if(a&&a.options[0]!==s)return null;const c=a?.options?.length||0;return e.jsx(o.Stack,{marginBottom:5,space:5,children:e.jsx(o.Stack,{space:2,children:a?.options.map(((t,n)=>e.jsx(x,{documentId:r,options:t,schemaType:i,showPresentationTitle:c>1},n)))})})}function j(n){const{children:r,options:o}=n,s=t.useContext(f),i=s?.register,[a,c]=t.useState((()=>[])),u=t.useCallback((e=>i?i(e):(c((t=>[e].concat(t))),()=>{c((t=>t.filter((t=>t!==e))))})),[i]),d=t.useRef(u);d.current=u;const l=t.useMemo((()=>({options:s?.options||a,register:u})),[a,s,u]);return t.useEffect((()=>d.current(o)),[o]),e.jsx(f.Provider,{value:l,children:r})}const y=n.defineDocumentFieldAction({name:"presentation/openInStructure",useAction({documentId:e,documentType:o,path:i}){const a=n.useWorkspace(),{navigateIntent:c}=s.useRouter(),u=t.useContext(d),l=t.useMemo((()=>function(e,t,r){const o=e.map((e=>{const n=e.canHandleIntent?.("edit",{id:t,type:r,mode:"structure"},{});return{tool:e,match:n}})),s=o.filter((e=>n.isRecord(e.match)&&e.match.mode));if(s.length>0)return s[0].tool;const i=o.filter((e=>e.match));return i[0]?.tool}(a.tools,e,o)),[e,o,a.tools]);return{type:"action",hidden:!u||i.length>0||!l,icon:l?.icon||r.MasterDetailIcon,title:`Open in ${l?.title||"Structure"}`,onAction(){c("edit",{id:e,type:o,mode:"structure",path:n.pathToString(i)})},renderAsButton:!0}}});function v(e,t,r,o){const{id:s,mode:i,path:a,presentation:c,type:u,...d}=t;return"edit"===e&&s?{type:u||"*",id:n.getPublishedId(s),path:a,_searchParams:Object.entries(d)}:{intent:e,params:t,payload:o}}const I=s.route.create("/",{__unsafe_disableScopedSearchParams:!0},[s.route.intents("/intent"),s.route.create("/:type",[s.route.create("/:id"),s.route.create("/:id/:path")])]),T=t.lazy((()=>Promise.resolve().then((function(){return require("./PresentationTool-iTmYSOKC.cjs")})))),C=t.lazy((()=>Promise.resolve().then((function(){return require("./BroadcastDisplayedDocument-C5qFa9UE.cjs")})))),b=n.definePlugin((r=>{const o=r.name||c;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==y.name)),y]},form:{components:{input:function(o){const s=o.value,i=s?._id?n.getPublishedId(s?._id):void 0;return n.isDocumentSchemaType(o.schemaType)?e.jsxs(j,{options:r,children:[i&&e.jsx(g,{documentId:i,options:r,schemaType:o.schemaType}),o.renderDefault(o),e.jsx(t.Suspense,{children:e.jsx(C,{value:s})},"broadcast-displayed-document")]}):o.renderDefault(o)}}},tools:[{icon:r.icon||a,name:o,title:r.title,component:T,options:r,canHandleIntent(e,t){if("edit"===e){if(!t.id)return!1;if(t.presentation&&t.presentation!==o)return!1;if(!t.mode)return!0;if("presentation"===t.mode)return{mode:!0}}return!1},getIntentState:v,router:I}]}})),S=t.createContext(null);const P=t.createContext(null);exports.A="2023-10-16",exports.D=c,exports.L=2048,exports.M=3e3,exports.P=d,exports.a=100,exports.b=S,exports.c=P,exports.d=1e3,exports.e=function(){const e=t.useContext(P);if(!e)throw new Error("Presentation params context is missing");return e},exports.p=b,exports.u=function(){const e=t.useContext(S);if(!e)throw new Error("Presentation navigate context is missing");return e};//# sourceMappingURL=index-gvCWCnr7.cjs.map
