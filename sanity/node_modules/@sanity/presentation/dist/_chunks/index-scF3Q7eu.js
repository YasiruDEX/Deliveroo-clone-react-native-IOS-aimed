import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{createContext as i,useState as r,useEffect as o,useContext as s,useCallback as a,createElement as c,useRef as d,useMemo as l,lazy as u,Suspense as m}from"react";import{useDocumentStore as p,defineDocumentFieldAction as h,useWorkspace as f,pathToString as g,isRecord as y,getPublishedId as v,definePlugin as w,isDocumentSchemaType as x}from"sanity";import{ComposeIcon as T,ChevronRightIcon as b,DesktopIcon as I,InfoOutlineIcon as P,WarningOutlineIcon as z,ErrorOutlineIcon as _,MasterDetailIcon as S}from"@sanity/icons";import{Card as j,Flex as A,Box as D,Text as k,Stack as B}from"@sanity/ui";import{useIntentLink as O,useRouter as C,route as E}from"sanity/router";import{isObservable as H,of as N}from"rxjs";const $=T,L="presentation",M="Presentation",U=3e3,q="2023-10-16",F=1e3,G=100,J=2048,K=i(null),Q={locations:[]};const R={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},V={positive:P,caution:z,critical:_};function W(i){const{documentId:d,options:l,schemaType:u,showPresentationTitle:m}=i,h=s(K),{message:f,locations:g,tone:y}=function(e){const{id:t,locate:n,type:i}=e,s=p(),[a,c]=r(Q);return o((()=>{if(!n)return;const e=n({id:t,type:i},{documentStore:s}),r=(H(e)?e:N(e)).subscribe((e=>c(e||Q)));return()=>r.unsubscribe()}),[s,t,n,i]),a}({id:d,locate:l.locate,type:u.name}),v=g?.length||0,[w,x]=r(!1),T=a((()=>x((e=>!e))),[]),I=f||(v?t(n,{children:["Used on ",R[v]||v," ",e(n,1===v?{children:"page"}:{children:"pages"})]}):null);return 0!==v||I?e(j,{padding:1,radius:3,border:!0,tone:y,children:t("div",{style:{margin:-1},children:[!g&&t(A,{align:"flex-start",gap:3,padding:3,children:[y&&e(D,{flex:"none",children:e(k,{size:1,children:c(V[y])})}),e(D,{flex:1,children:t(k,{size:1,weight:"medium",children:[m&&t(n,{children:[l.title||M," · "]}),I]})})]}),g&&t(n,{children:[e(j,{as:"button",onClick:T,padding:3,radius:2,tone:"inherit",children:t(A,{gap:3,children:[e(D,{flex:"none",children:e(k,{size:1,children:e(b,{style:{transform:`rotate(${w?"90deg":0})`,transition:"transform 100ms ease-in-out"}})})}),e(D,{flex:1,children:t(k,{size:1,weight:"medium",children:[m&&t(n,{children:[l.title||M," · "]}),I]})})]})}),e(B,{hidden:!w,marginTop:1,space:1,children:g.map(((t,n)=>e(X,{active:(l.name||L)===h?.name&&t.href===h?.params.preview,documentId:d,documentType:u.name,node:t,toolName:l.name||L},n)))})]})]})}):null}function X(n){const{documentId:i,documentType:r,node:o,active:d,toolName:l}=n,u=s(K),m=u?.navigate,p=O({intent:"edit",params:{id:i,type:r,mode:"presentation",presentation:l,...u?.deskParams,preview:o.href}}),h=a((()=>{m?.({},{preview:o.href})}),[o.href,m]);return c(j,{...u?{}:p,as:u?"button":"a",key:o.href,onClick:h,padding:3,radius:2,pressed:d,tone:"inherit"},t(A,{gap:3,children:[e(D,{flex:"none",children:e(k,{size:1,children:e(I,{})})}),t(B,{flex:1,space:2,children:[e(k,{size:1,weight:"medium",children:o.title}),e(k,{muted:!0,size:1,textOverflow:"ellipsis",children:o.href})]})]}))}const Y=i(null);function Z(t){const{documentId:n,options:i,schemaType:r}=t,o=s(Y);if(o&&o.options[0]!==i)return null;const a=o?.options?.length||0;return e(B,{marginBottom:5,space:5,children:e(B,{space:2,children:o?.options.map(((t,i)=>e(W,{documentId:n,options:t,schemaType:r,showPresentationTitle:a>1},i)))})})}function ee(t){const{children:n,options:i}=t,c=s(Y),u=c?.register,[m,p]=r((()=>[])),h=a((e=>u?u(e):(p((t=>[e].concat(t))),()=>{p((t=>t.filter((t=>t!==e))))})),[u]),f=d(h);f.current=h;const g=l((()=>({options:c?.options||m,register:h})),[m,c,h]);return o((()=>f.current(i)),[i]),e(Y.Provider,{value:g,children:n})}const te=h({name:"presentation/openInStructure",useAction({documentId:e,documentType:t,path:n}){const i=f(),{navigateIntent:r}=C(),o=s(K),a=l((()=>function(e,t,n){const i=e.map((e=>{const i=e.canHandleIntent?.("edit",{id:t,type:n,mode:"structure"},{});return{tool:e,match:i}})),r=i.filter((e=>y(e.match)&&e.match.mode));if(r.length>0)return r[0].tool;const o=i.filter((e=>e.match));return o[0]?.tool}(i.tools,e,t)),[e,t,i.tools]);return{type:"action",hidden:!o||n.length>0||!a,icon:a?.icon||S,title:`Open in ${a?.title||"Structure"}`,onAction(){r("edit",{id:e,type:t,mode:"structure",path:g(n)})},renderAsButton:!0}}});function ne(e,t,n,i){const{id:r,mode:o,path:s,presentation:a,type:c,...d}=t;return"edit"===e&&r?{type:c||"*",id:v(r),path:s,_searchParams:Object.entries(d)}:{intent:e,params:t,payload:i}}const ie=E.create("/",{__unsafe_disableScopedSearchParams:!0},[E.intents("/intent"),E.create("/:type",[E.create("/:id"),E.create("/:id/:path")])]),re=u((()=>import("./PresentationTool-WsqyCX7G.js"))),oe=u((()=>import("./BroadcastDisplayedDocument-wqFBqRfN.js"))),se=w((n=>{const i=n.name||L;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==te.name)),te]},form:{components:{input:function(i){const r=i.value,o=r?._id?v(r?._id):void 0;return x(i.schemaType)?t(ee,{options:n,children:[o&&e(Z,{documentId:o,options:n,schemaType:i.schemaType}),i.renderDefault(i),e(m,{children:e(oe,{value:r})},"broadcast-displayed-document")]}):i.renderDefault(i)}}},tools:[{icon:n.icon||$,name:i,title:n.title,component:re,options:n,canHandleIntent(e,t){if("edit"===e){if(!t.id)return!1;if(t.presentation&&t.presentation!==i)return!1;if(!t.mode)return!0;if("presentation"===t.mode)return{mode:!0}}return!1},getIntentState:ne,router:ie}]}})),ae=i(null);function ce(){const e=s(ae);if(!e)throw new Error("Presentation navigate context is missing");return e}const de=i(null);function le(){const e=s(de);if(!e)throw new Error("Presentation params context is missing");return e}export{q as A,L as D,J as L,U as M,K as P,G as a,ae as b,de as c,F as d,le as e,se as p,ce as u};//# sourceMappingURL=index-scF3Q7eu.js.map
